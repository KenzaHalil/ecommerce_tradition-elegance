{% extends "base.html" %}
{% block title %}Mon compte - Tradition & Élégance{% endblock %}
{% block content %}
<style>
  :root{
    --brand:#8B1C2E;
    --soft-pink:#F6D7D7;
    --paper:#FFF8F0;
  }
  .profile-hero{
    background: linear-gradient(90deg, rgba(246,215,215,0.55), rgba(255,249,246,1));
    border-radius:14px;
    padding:2.4rem 1.6rem;
    margin-bottom:1.6rem;
    box-shadow:0 10px 30px rgba(15,23,42,0.05);
  }
  .profile-hero h1{
    font-family:"Playfair Display",serif;
    color:var(--brand);
    font-size:2.4rem;
    margin:0;
  }

  .profile-body{
    display:flex;
    gap:1.4rem;
    align-items:flex-start;
  }
  .card-profile{
    flex:1;
    border-radius:12px;
    padding:1.2rem;
    box-shadow:0 12px 36px rgba(15,23,42,0.04);
    border:1px solid rgba(139,28,46,0.03);
    background:#fff;
  }
  .side-card{
    width:320px;
    border-radius:12px;
    padding:1.2rem;
    background:linear-gradient(180deg,var(--soft-pink),rgba(255,250,250,0.96));
    box-shadow:0 10px 30px rgba(15,23,42,0.04);
    border:1px solid rgba(139,28,46,0.03);
  }

  .avatar{
    width:160px; height:160px; border-radius:50%;
    object-fit:cover; border:4px solid var(--paper);
    box-shadow: 0 8px 22px rgba(15,23,42,0.07);
    display:block;
  }

  .initials{
    width:160px; height:160px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg, rgba(139,28,46,0.06), rgba(139,28,46,0.02));
    color:var(--brand); font-weight:700; font-size:40px;
    box-shadow: 0 8px 22px rgba(15,23,42,0.04);
  }

  .btn-edit{ width:100%; margin-top:.9rem; }

  .meta-row{ margin-bottom:.6rem; }
  .meta-row .label{ font-weight:700; color:rgba(123,33,38,0.9); }
  .meta-row .value{ color:var(--brand); font-weight:600; text-decoration:underline; }

  @media (max-width: 991px){
    .profile-body{ flex-direction:column; }
    .side-card{ width:100%; order:2; }
  }
</style>

<div class="container">
  <div class="profile-hero">
    <h1>Mon compte</h1>
    <p class="text-muted" style="margin-top:.4rem">Gère tes informations, ta photo de profil et tes préférences.</p>
  </div>

  <div class="profile-body">
    <section class="card-profile">
      <div class="row g-3">
        <div class="col-12 d-flex align-items-center gap-3">
          {% if user.profile_image %}
            <img id="profilePreview" src="{{ url_for('static', filename=user.profile_image) }}" alt="Avatar" class="avatar">
          {% else %}
            <div id="profilePreview" class="initials">{{ (user.first_name[0] if user.first_name else 'U') }}{{ (user.last_name[0] if user.last_name else 'A') }}</div>
          {% endif %}

          <div>
            <h4 style="font-family:'Playfair Display',serif;color:var(--brand);margin-bottom:4px;">{{ user.first_name or '' }} {{ user.last_name or '' }}</h4>
            <p class="text-muted mb-1">{{ user.email }}</p>

            <a href="{{ url_for('profile.edit_profile') }}" class="btn btn-primary btn-edit">Modifier le profil</a>
          </div>
        </div>

        <div class="col-12">
          <h5 style="font-family:'Playfair Display',serif;color:var(--brand);margin-bottom:.5rem;">À propos</h5>
          <p class="text-muted">Ajoute une photo, modifie ton nom ou ton adresse e‑mail. Les informations partagées restent privées.</p>
        </div>

        <div class="col-12">
          <form method="post" enctype="multipart/form-data" class="d-flex gap-2 align-items-center">
            <input type="file" name="profile_image" accept="image/*" class="form-control form-control-sm" onchange="previewProfile(this)">
            <button class="btn btn-outline-secondary btn-sm" type="submit">Téléverser</button>
            <small class="text-muted">PNG, JPG — max 2MB</small>
          </form>
        </div>
      </div>
    </section>

    <!-- Coordonnées supprimées à la demande -->
    <!-- aside.side-card removed -->

  </div>
</div>

<script>
function previewProfile(input){
  if(!input.files || !input.files[0]) return;
  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = e => {
    const el = document.getElementById('profilePreview');
    if(el.tagName === 'IMG'){
      el.src = e.target.result;
    } else {
      // replace initials div with an img element
      const img = document.createElement('img');
      img.id = 'profilePreview';
      img.className = 'avatar';
      img.src = e.target.result;
      el.replaceWith(img);
    }
  };
  reader.readAsDataURL(file);
}
</script>
{% endblock %}